@using Web_Hutech_Gear.Models.EF
@using Web_Hutech_Gear.Models

@model News
@{
    ViewBag.Title = "Chi Tiết Tin Tức";
    Layout = "~/Views/Shared/_Layout.cshtml";

    int idCurrent = ViewBag.idCurrent;
    int first = idCurrent - 1;
    int last = idCurrent + 1;
    int idMax = ViewBag.idMaxTmp;

    if (0 >= first)
    {
        first = 0;
    }
    if (ViewBag.idMaxTmp < last)
    {
        last = 0;
    }

    ApplicationDbContext db = new ApplicationDbContext();
}

<div id="inner_banner" class="section inner_banner_section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="full">
                    <div class="title-holder">
                        <div class="title-holder-cell text-left">
                            <h1 class="page-title">Chi Tiết Tin Tức</h1>
                            <ol class="breadcrumb">
                                <li><a href="index.html">Home</a></li>
                                <li class="active">Trang Chi Tiết (@Model.Title)</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end inner page banner -->
<!-- section -->
<div class="section padding_layout_1 blog_grid">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12 pull-right">
                <div class="full">
                    <div class="blog_section margin_bottom_0">
                        <div class="blog_feature_img"> <img class="img-responsive" src="@Model.Image" alt="@Model.Title"> </div>
                        <div class="blog_feature_cantant">
                            <p class="blog_head">@Model.Title</p>
                            <div class="post_info">
                                <ul>
                                    @if (string.IsNullOrEmpty(Model.CreatedBy))
                                    {
                                        <li><i class="fa fa-user" aria-hidden="true"></i> Admin</li>
                                    }
                                    else
                                    {
                                        <li><i class="fa fa-user" aria-hidden="true"></i> @Model.CreatedBy</li>
                                    }
                                    @*<li><i class="fa fa-comment" aria-hidden="true"></i> 5</li>*@
                                    <li><i class="fa fa-calendar" aria-hidden="true"></i>@string.Format("{0:dd/MM/yyyy}", Model.CreatedDate)</li>
                                </ul>
                            </div>
                            <p>@Html.Raw(Model.Detail)</p>
                        </div>


                        <div class="comment_section">
                            @if (first != 0)
                            {
                                <div class="pull-left text_align_left">
                                    <div class="full">
                                        <div class="preview_commt">
                                            <a class="comment_cantrol preview_commat" href="/News/DetailNew?id=@first">
                                                <span>
                                                    <i class="fa fa-angle-left"></i>
                                                    <i class="fa fa-angle-left"></i>
                                                    Bài Trước
                                                </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }
                            @if (last != 0)
                            {
                                <div class="pull-right text_align_right">
                                    <div class="full">
                                        <div class="next_commt">
                                            <a class="comment_cantrol preview_commat" href="/News/DetailNew?id=@last">
                                                <span>
                                                    Tiếp Theo
                                                    <i class="fa fa-angle-right"></i>
                                                    <i class="fa fa-angle-right"></i>
                                                </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <br />
                        <div class="view_commant">
                            <div class="row">
                                <div class="col-lg-10 col-md-10 col-sm-9 col-xs-12">
                                    @if (null != ViewBag.comments)
                                    {
                                        foreach (var item in ViewBag.comments)
                                        {
                                            string userId = item.UserId;

                                            <div style="padding-bottom:40px">
                                                <p class="comm_head">@db.Users.FirstOrDefault(p => p.Id == userId).FullName <span Ngày:>@item.CreatedDate.ToString("dd-MM-yyyy")</span></p>
                                                <!-- #region rating -->
                                                <span class="rating">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        <i class="fa fa-star@(i <= item.Rating ? "" : "-o")" aria-hidden="true"></i>
                                                    }
                                                </span>
                                                <!-- #endregion -->
                                                <p> @item.Content </p>
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="post_commt_form">
                            <div class="form_section">
                                @if (Request.IsAuthenticated)
                                {
                                    using (Html.BeginForm("Comment", "News", new { @url = Request.Url.ToString() }))
                                    {
                                        <h4 style="padding-bottom:10px">Bình Luận Bài Viết</h4>
                                        <fieldset class="row">
                                            Mức Độ: 
                                            <div class="rating field col-lg-4 col-md-4 col-sm-6 col-xs-12">
                                                <span class="fa fa-star-o rating-star" data-rating="1"></span>
                                                <span class="fa fa-star-o rating-star" data-rating="2"></span>
                                                <span class="fa fa-star-o rating-star" data-rating="3"></span>
                                                <span class="fa fa-star-o rating-star" data-rating="4"></span>
                                                <span class="fa fa-star-o rating-star" data-rating="5"></span>
                                            </div>
                                            <input type="hidden" name="rating" id="rating" value="5">
                                            <div class="field col-lg-4 col-md-4 col-sm-6 col-xs-12" style="display:none">
                                                <input class="field_custom" name="newsId" value="@Model.Id" type="text" required>
                                            </div>
                                            <div class="field col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                <textarea name="content" class="field_custom" placeholder="Comment" required></textarea>
                                            </div>
                                            <div class="center">
                                                <button class="btn main_bt">Bình Luận</button>
                                            </div>
                                        </fieldset>
                                    }
                                }
                                else
                                {
                                    <a href="/Account/Login">Đăng Nhập Để Bình Luận</a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 pull-left">
                <div class="side_bar">
                    <div class="side_bar_blog">
                        <h4>SEARCH</h4>
                        <div class="side_bar_search">
                            <div class="input-group stylish-input-group">
                                <input class="form-control" placeholder="Search" type="text">
                                <span class="input-group-addon">
                                    <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="side_bar_blog">
                        <h4>ABOUT AUTHOR</h4>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. sed do eiusmod tempor.</p>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    </div>
                    <div class="side_bar_blog">
                        <h4>RECENT POST</h4>
                        <div class="recent_post">
                            <ul>
                                <li>
                                    <p class="post_head"><a href="#">How To Look Up</a></p>
                                    <p class="post_date"><i class="fa fa-calendar" aria-hidden="true"></i> Aug 20, 2017</p>
                                </li>
                                <li>
                                    <p class="post_head"><a href="#">Compatible Inkjet Cartridge</a></p>
                                    <p class="post_date"><i class="fa fa-calendar" aria-hidden="true"></i> Aug 20, 2017</p>
                                </li>
                                <li>
                                    <p class="post_head"><a href="#">Treat That Oral Thrush Now</a></p>
                                    <p class="post_date"><i class="fa fa-calendar" aria-hidden="true"></i> Aug 20, 2017</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="side_bar_blog">
                        <h4>CATEGORIES</h4>
                        <div class="categary">
                            <ul>
                                <li><a href="#"><i class="fa fa-caret-right"></i> Change Oil and Filter</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> Brake Pads Replacement</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> Timing Belt Replacement</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> Pre-purchase Car Inspection</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> Starter Replacement</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="side_bar_blog">
                        <h4>TAG</h4>
                        <div class="tags">
                            <ul>
                                <li><a href="#">Bootstrap</a></li>
                                <li><a href="#">HTML5</a></li>
                                <li><a href="#">Wordpress</a></li>
                                <li><a href="#">Bootstrap</a></li>
                                <li><a href="#">HTML5</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="side_bar_blog">
                        <h4>CATEGORIES</h4>
                        <div class="categary">
                            <ul>
                                <li><a href="#"><i class="fa fa-caret-right"></i> June (12)</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> January (12)</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> March (12)</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> November (12)</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i> December (12)</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end section -->
<!-- Modal -->
<div class="modal fade" id="search_bar" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><i class="fa fa-close"></i></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-8 col-md-8 col-sm-8 offset-lg-2 offset-md-2 offset-sm-2 col-xs-10 col-xs-offset-1">
                        <div class="navbar-search">
                            <form action="#" method="get" id="search-global-form" class="search-global">
                                <input type="text" placeholder="Type to search" autocomplete="off" name="s" id="search" value="" class="search-global__input">
                                <button class="search-global__btn"><i class="fa fa-search"></i></button>
                                <div class="search-global__note">Begin typing your search above and press return to search.</div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Model search bar -->
@section scripts{
    <!--Sự kiện chọn ngôi sao đánh giá-->
    <script>
        const stars = document.querySelectorAll(".rating-star");
        const ratingInput = document.querySelector("#rating");
        // Đánh dấu sẵn 5 ngôi sao
        for (let i = 0; i < stars.length; i++) {
            stars[i].classList.replace("fa-star-o", "fa-star");
        }
        stars.forEach((star, index) => {
            star.addEventListener("click", (e) => {
                const selectedRating = e.target.getAttribute("data-rating");
                ratingInput.value = selectedRating;
                for (let i = 0; i <= index; i++) {
                    stars[i].classList.replace("fa-star-o", "fa-star");
                }
                for (let i = index + 1; i < stars.length; i++) {
                    stars[i].classList.replace("fa-star", "fa-star-o");
                }
            });
        });
    </script>
}